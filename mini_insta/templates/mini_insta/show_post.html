<!-- 
Author: Anna Ni
Email: annani@bu.edu
Course: CS412 - Django Project
File: show_post.html
Description: Template for displaying a single user post in Mini Insta.
-->
<h1>Post by {{ post.profile.username }}</h1>

<!-- Like count -->
<p style="margin: 0.5rem 0;">
  <strong>‚ù§Ô∏è {{ object.get_num_likes }} Like{{ object.get_num_likes|pluralize }}</strong>
</p>

<p>{{ object.caption }}</p>
<p><em>{{ object.timestamp }}</em></p>

<!--  Photos Section - Changed from photo_set to photos -->
{% if object.photos.all %}
  <h2>Photos:</h2>
  <div style="display:flex; flex-wrap:wrap; gap:1rem;">
    {% for photo in object.photos.all %}
      <div style="flex: 1 1 200px; text-align:center;">
        <img src="{{ photo.get_image_url }}" 
             alt="Post Image {{ forloop.counter }}" 
             width="300" 
             style="border-radius:8px; max-width:100%; height:auto; border:1px solid #ddd;">
      </div>
    {% endfor %}
  </div>
{% elif object.image_url %}
  <!--  Fallback for old posts that still use image_url -->
  <h2>Photo:</h2>
  <img src="{{ object.image_url }}" alt="Post Image" width="300" style="border-radius:8px;">
{% else %}
  <p><em>No image available</em></p>
{% endif %}

<!-- Edit and Delete Links -->
<p>
  <a href="{% url 'mini_insta:update_post' object.pk %}" 
     style="padding:0.5rem 1rem; background:#ffc107; color:black; border-radius:6px; text-decoration:none;">
    ‚úèÔ∏è Update
  </a>

  <a href="{% url 'mini_insta:delete_post' object.pk %}" 
     style="padding:0.5rem 1rem; background:#dc3545; color:white; border-radius:6px; text-decoration:none;">
    üóë Delete Post
  </a>
</p>


<!-- Link back to profile -->
<p><a href="{% url 'mini_insta:show_profile' object.profile.pk %}">Back to Profile</a></p>

<!-- Comments Section -->
<div style="margin-top: 2rem; border-top: 2px solid #eee; padding-top: 1rem;">
  <h2>Comments</h2>
  
  {% with comments=object.get_all_comments %}
    {% if comments %}
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for comment in comments %}
          <div style="border: 1px solid #eee; padding: 1rem; border-radius: 8px; background: #f9f9f9;">
            <p style="margin: 0 0 0.5rem 0;">
              <a href="{% url 'mini_insta:show_profile' comment.profile.pk %}" 
                 style="font-weight: bold; color: #007bff; text-decoration: none;">
                {{ comment.profile.username }}
              </a>
              <span style="color: #888; font-size: 0.9rem; margin-left: 0.5rem;">
                {{ comment.timestamp|date:"M d, Y g:i A" }}
              </span>
            </p>
            <p style="margin: 0;">{{ comment.text }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #888;">No comments yet.</p>
    {% endif %}
  {% endwith %}
</div>