<!-- 
Author: Anna Ni (annani@bu.edu)
File: show_post.html
Description: Template for displaying a single user post in Mini Insta.
-->


{% extends 'mini_insta/base.html' %}

{% block content %}
<h1>Post by {{ post.profile.username }}</h1>

<!-- Like count and Like/Unlike button -->
<div style="margin: 1rem 0; display: flex; align-items: center; gap: 1rem;">
  <p style="margin: 0;">
    <strong>‚ù§Ô∏è {{ object.get_num_likes }} Like{{ object.get_num_likes|pluralize }}</strong>
  </p>
  
  <!-- Like/Unlike Button (only show if user is authenticated and not viewing own post) -->
  {% if request.user.is_authenticated %}
    {% if request.user != object.profile.user %}
      {% if request.user.profile in object.get_all_likes %}
        <a href="{% url 'mini_insta:unlike_post' object.pk %}" 
           style="padding:0.4rem 1rem; background:#dc3545; color:white; text-decoration:none; border-radius:6px; font-size:0.9rem;">
          üíî Unlike
        </a>
      {% else %}
        <a href="{% url 'mini_insta:like_post' object.pk %}" 
           style="padding:0.4rem 1rem; background:#e74c3c; color:white; text-decoration:none; border-radius:6px; font-size:0.9rem;">
          ‚ù§Ô∏è Like
        </a>
      {% endif %}
    {% endif %}
  {% endif %}
</div>

<p>{{ object.caption }}</p>
<p><em>{{ object.timestamp }}</em></p>

<!--  Photos Section - Changed from photo_set to photos -->
{% if object.photos.all %}
  <h2>Photos:</h2>
  <div style="display:flex; flex-wrap:wrap; gap:1rem;">
    {% for photo in object.photos.all %}
      <div style="flex: 1 1 200px; text-align:center;">
        <img src="{{ photo.get_image_url }}" 
             alt="Post Image {{ forloop.counter }}" 
             width="300" 
             style="border-radius:8px; max-width:100%; height:auto; border:1px solid #ddd;">
      </div>
    {% endfor %}
  </div>
{% elif object.image_url %}
  <!--  Fallback for old posts that still use image_url -->
  <h2>Photo:</h2>
  <img src="{{ object.image_url }}" alt="Post Image" width="300" style="border-radius:8px;">
{% else %}
  <p><em>No image available</em></p>
{% endif %}

<!-- Edit and Delete Links (only show if viewing own post) -->
{% if request.user.is_authenticated and request.user == object.profile.user %}
  <p>
    <a href="{% url 'mini_insta:update_post' object.pk %}" 
       style="padding:0.5rem 1rem; background:#ffc107; color:black; border-radius:6px; text-decoration:none;">
      ‚úèÔ∏è Update
    </a>

    <a href="{% url 'mini_insta:delete_post' object.pk %}" 
       style="padding:0.5rem 1rem; background:#dc3545; color:white; border-radius:6px; text-decoration:none;">
      üóë Delete Post
    </a>
  </p>
{% endif %}

<!-- Link back to profile -->
<p><a href="{% url 'mini_insta:show_profile' object.profile.pk %}">Back to Profile</a></p>

<!-- Comments Section -->
<div style="margin-top: 2rem; border-top: 2px solid #eee; padding-top: 1rem;">
  <h2>Comments</h2>
  
  {% with comments=object.get_all_comments %}
    {% if comments %}
      <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for comment in comments %}
          <div style="border: 1px solid #eee; padding: 1rem; border-radius: 8px; background: #f9f9f9;">
            <p style="margin: 0 0 0.5rem 0;">
              <a href="{% url 'mini_insta:show_profile' comment.profile.pk %}" 
                 style="font-weight: bold; color: #007bff; text-decoration: none;">
                {{ comment.profile.username }}
              </a>
              <span style="color: #888; font-size: 0.9rem; margin-left: 0.5rem;">
                {{ comment.timestamp|date:"M d, Y g:i A" }}
              </span>
            </p>
            <p style="margin: 0;">{{ comment.text }}</p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #888;">No comments yet.</p>
    {% endif %}
  {% endwith %}
</div>

{% endblock %}