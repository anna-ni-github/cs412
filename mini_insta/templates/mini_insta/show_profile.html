<!-- 
Author: Anna Ni
Email: annani@bu.edu
Course: CS412 - Django Project
File: show_profile.html
Description: Template for displaying a single user profile in Mini Insta.
-->

{% extends 'mini_insta/base.html' %}

{% block content %}
  <div style="display:flex; gap:2rem; align-items:flex-start;">
    <div>
      {% if profile.profile_image_url %}
        <img src="{{ profile.profile_image_url }}" alt="{{ profile.username }}" 
             style="width:240px;height:240px;object-fit:cover;border-radius:12px;">
      {% else %}
        <div style="width:240px;height:240px;border-radius:12px;background:#ddd;
                    display:flex;align-items:center;justify-content:center;">
          No image
        </div>
      {% endif %}
    </div>

    <div>
      <h2>{{ profile.display_name }}</h2>
      <p style="margin:0;color:#666">@{{ profile.username }}</p>
      <p style="margin-top:1rem;">{{ profile.bio_text }}</p>
      <p style="color:#888;font-size:0.9rem;margin-top:1rem;">
        Joined: {{ profile.join_date }}
      </p>

      <!-- placeholders for Task 3/4 -->
      <div style="margin-top:1.5rem; padding:0.8rem; border:1px dashed #eee; color:#777;">
        <p><strong>Followers:</strong> (coming soon)</p>
        <p><strong>Following:</strong> (coming soon)</p>
        <p><strong>Posts:</strong> (coming soon)</p>
      </div>
    </div>
  </div>

  <!-- NEW: Posts section -->
  <div style="margin-top:2rem;">
    <h2>Posts</h2>

    <!-- CREATE POST LINK -->
    <p>
      <a href="{% url 'mini_insta:create_post' profile.pk %}" 
         style="padding:0.5rem 1rem; background:#007bff; color:white; text-decoration:none; border-radius:6px;">
        + Create New Post
      </a>
    </p>

    {% for post in profile.get_all_posts %}
      <div style="border:1px solid #eee; padding:1rem; margin-bottom:1rem; border-radius:8px;">
        <p style="margin:0 0 0.5rem 0;"><em>{{ post.timestamp }}</em></p>
        <p>{{ post.caption }}</p>

        {% with photos=post.get_all_photos %}
          {% if photos %}
            <img src="{{ photos.0.image_url }}" alt="Post photo" 
                 style="width:300px; height:auto; border-radius:8px;">
          {% else %}
            <div style="width:300px; height:200px; background:#ddd; 
                        display:flex; align-items:center; justify-content:center;
                        border-radius:8px;">
              No image available
            </div>
          {% endif %}
        {% endwith %}

        <!-- Link to PostDetailView -->
        <p><a href="{% url 'mini_insta:show_post' post.pk %}">View Post Details â†’</a></p>
      </div>
    {% empty %}
      <p>No posts yet.</p>
    {% endfor %}
  </div>
{% endblock %}
