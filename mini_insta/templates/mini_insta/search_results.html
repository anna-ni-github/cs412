<!-- 
File: search_results.html
Description: Template for displaying search results
-->

{% extends 'mini_insta/base.html' %}

{% block content %}
<div style="max-width: 800px; margin: 2rem auto;">
  <h2>Search Results for "{{ query }}"</h2>
  
  <p style="margin-bottom: 2rem;">
    <a href="{% url 'mini_insta:search' profile.pk %}" 
       style="color: #007bff; text-decoration: none;">
      ‚Üê New Search
    </a>
  </p>

  <!-- Profiles Results Section -->
  <div style="margin-bottom: 3rem;">
    <h3 style="border-bottom: 2px solid #007bff; padding-bottom: 0.5rem;">
      Profiles ({{ profiles.count }})
    </h3>
    
    {% if profiles %}
      <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
        {% for found_profile in profiles %}
          <div style="border: 1px solid #eee; padding: 1rem; border-radius: 8px; 
                      display: flex; align-items: center; gap: 1rem;">
            {% if found_profile.profile_image_url %}
              <img src="{{ found_profile.profile_image_url }}" 
                   alt="{{ found_profile.username }}"
                   style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover;">
            {% else %}
              <div style="width: 60px; height: 60px; border-radius: 50%; background: #ddd;
                          display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                üë§
              </div>
            {% endif %}
            
            <div style="flex: 1;">
              <a href="{% url 'mini_insta:show_profile' found_profile.pk %}" 
                 style="font-weight: bold; text-decoration: none; color: #007bff; font-size: 1.1rem;">
                {{ found_profile.display_name }}
              </a>
              <p style="margin: 0; color: #666;">@{{ found_profile.username }}</p>
              {% if found_profile.bio_text %}
                <p style="margin: 0.5rem 0 0 0; color: #888; font-size: 0.9rem;">
                  {{ found_profile.bio_text|truncatewords:20 }}
                </p>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #888; margin-top: 1rem;">No profiles found matching "{{ query }}"</p>
    {% endif %}
  </div>

  <!-- Posts Results Section -->
  <div>
    <h3 style="border-bottom: 2px solid #28a745; padding-bottom: 0.5rem;">
      Posts ({{ posts.count }})
    </h3>
    
    {% if posts %}
      <div style="display: flex; flex-direction: column; gap: 1.5rem; margin-top: 1rem;">
        {% for post in posts %}
          <div style="border: 1px solid #eee; padding: 1rem; border-radius: 8px;">
            <!-- Post Author -->
            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
              {% if post.profile.profile_image_url %}
                <img src="{{ post.profile.profile_image_url }}" 
                     alt="{{ post.profile.username }}"
                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
              {% else %}
                <div style="width: 40px; height: 40px; border-radius: 50%; background: #ddd;
                            display: flex; align-items: center; justify-content: center;">
                  üë§
                </div>
              {% endif %}
              
              <div>
                <a href="{% url 'mini_insta:show_profile' post.profile.pk %}" 
                   style="font-weight: bold; text-decoration: none; color: #000;">
                  {{ post.profile.display_name }}
                </a>
                <p style="margin: 0; color: #666; font-size: 0.85rem;">
                  @{{ post.profile.username }}
                </p>
              </div>
            </div>

            <!-- Post Photo (first one if multiple) -->
            {% if post.photos.all %}
              <img src="{{ post.photos.first.get_image_url }}" 
                   alt="Post photo"
                   style="width: 100%; max-height: 400px; object-fit: cover; 
                          border-radius: 8px; margin: 0.5rem 0;">
            {% endif %}

            <!-- Post Caption -->
            <p style="margin: 0.5rem 0;">
              <strong>{{ post.profile.username }}</strong> {{ post.caption }}
            </p>

            <!-- Post Metadata -->
            <p style="margin: 0.5rem 0; color: #888; font-size: 0.9rem;">
              ‚ù§Ô∏è {{ post.get_num_likes }} likes ‚Ä¢ 
              üí¨ {{ post.get_all_comments.count }} comments ‚Ä¢ 
              {{ post.timestamp|date:"M d, Y" }}
            </p>

            <!-- Link to full post -->
            <p style="margin-top: 0.5rem;">
              <a href="{% url 'mini_insta:show_post' post.pk %}" 
                 style="color: #007bff; text-decoration: none; font-size: 0.9rem;">
                View full post ‚Üí
              </a>
            </p>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p style="color: #888; margin-top: 1rem;">No posts found matching "{{ query }}"</p>
    {% endif %}
  </div>

  <!-- Back to Profile -->
  <p style="margin-top: 2rem; text-align: center;">
    <a href="{% url 'mini_insta:show_profile' profile.pk %}" 
       style="color: #007bff; text-decoration: none;">
      ‚Üê Back to Profile
    </a>
  </p>
</div>
{% endblock %}